{% extends "base.html" %}
{% block title %}Home page{% endblock %}
{% block content %}

<link rel="stylesheet" href="/public/css/cryptoResult.css">

<!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container">
  <div class="tradingview-widget-container__widget"></div>
  <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
    {
      "symbols": [
        {
          "proName": "BITSTAMP:BTCUSD",
          "title": "Bitcoin"
        },
        {
          "proName": "BITSTAMP:ETHUSD",
          "title": "Ethereum"
        },
        {
          "description": "Solana",
          "proName": "COINBASE:SOLUSD"
        },
        {
          "description": "Doge",
          "proName": "BINANCE:DOGEUSD"
        },
        {
          "description": "Polkadot",
          "proName": "BINANCE:DOTUSD"
        }
      ],
        "showSymbolLogo": true,
          "isTransparent": false,
            "displayMode": "adaptive",
              "colorTheme": "dark",
                "locale": "en"
    }
  </script>
</div>
<!-- TradingView Widget END -->
<div class="row container mt-4">
  <div class="col-md-8">
    <h1>Crypto page</h1>
    <p class="lead">Get the latest updates on your favorite cryptocurrencies by entering their ticker symbol below.</p>
    <p>Stay informed and make better investment decisions with real-time data.</p>
  </div>
  <div class="col-md-4" id="fearAndGreed">
  </div>
</div>

<div class="container mt-4">
  <h1>Cryptocurrencies by Market Cap</h1>
  <div id="output" style="margin-top: 20px; font-size: 18px;"></div>
</div>

<div class="button-group d-flex align-items-center justify-content-center" style="padding-top: 30px;">
  <button type="button" onclick="fetchData(1)">1</button>
  <button type="button" onclick="fetchData(2)">2</button>
  <button type="button" onclick="fetchData(3)">3</button>
  <button type="button" onclick="fetchData(4)">4</button>
  <button type="button" onclick="fetchData(5)">5</button>
</div>

{% endblock %}



{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    loadRSSFeed();
    loadFearAndGreed();
  });

  function loadRSSFeed() {
    fetch('/crypto/bitcoinDataOverview/1')
      .then(response => response.text())  // Změna na text, protože vracíme HTML
      .then(data => {
        document.getElementById('output').innerHTML = data;  // Použijeme innerHTML
      })
      .catch(error => {
        console.error('Error loading RSS feed:', error);
        document.getElementById('output').innerHTML = '<p>Error loading feed.</p>';
      });
  }

  function fetchData(buttonNumber) {
    // URL pro vaše API
    const apiUrl = `/bitcoinDataOverview/${buttonNumber}`;

    fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then(response => response.text())  // Změna na text, protože vracíme HTML
      .then(data => {
        document.getElementById('output').innerHTML = data || 'No data available.';  // Použijeme innerHTML
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('output').innerHTML = 'Error loading data.';
      });
  }

  async function loadFearAndGreed() {
    try {
      const response = await fetch('/api/crypto_fear_and_greed', {
        method: 'GET',
        headers: {
          'Content-Type': 'text/html'
        }
      });

      if (response.ok) {
        const htmlContent = await response.text(); // Získání HTML obsahu jako text
        const fearAndGreedContainer = document.getElementById('fearAndGreed');

        // Vložení HTML obsahu do určeného elementu
        fearAndGreedContainer.innerHTML = htmlContent;
      } else {
        console.error("Failed to load Fear and Greed data:", response.status);
      }
    } catch (error) {
      console.error("Error loading Fear and Greed data:", error);
    }
  }


</script>
{% endblock %}